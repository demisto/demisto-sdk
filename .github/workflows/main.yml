# This is a basic workflow to help you get started with Actions

name: ValidateChangelog

on: pull_request

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Check whether a changelog is necessary
        uses: tj-actions/verify-changed-files@v9
        id: need-changelog
        with:
          files: |
            **/*.py
            pyproject.toml
      
      - name: Check whether CHANGELOG.md changed
        uses: tj-actions/verify-changed-files@v9
        id: changelog-status
        with:
          files: CHANGELOG.md
        
      - name: Missing changed file
        if: |
          steps.need-changelog.outputs.files_changed == 'true' &&
          steps.changelog-status.outputs.files_changed == 'false'
        uses: actions/github-script@v3
        with:
          script: |
              core.setFailed('Missing CHANGELOG.md update!')
