name: SDK Release
on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'The PR number'
        required: true
        type: string
      pr_title:
        description: 'The PR title'
        required: true
        type: string
      branch_name:
        description: 'The branch name'
        required: true
        type: string

jobs:
  SDK-Release:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Poetry
        uses: Gr1N/setup-poetry@48b0f77c8c1b1b19cb962f0f00dff7b4be8f81ec # v9

      - name: Checkout
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4
        with:
          fetch-depth: 0
          ref: ${{ inputs.branch_name }}

      - name: Setup python
        uses: actions/setup-python@8d9ed9ac5c53483de85588cdf95a591a75ab9f55 # v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: poetry install

      - name: Releasing
        env:
          PR_NUMBER: ${{ inputs.pr_number }}
          PR_TITLE: ${{ inputs.pr_title }}
          BRANCH_NAME: ${{ inputs.branch_name }}
        run: |
          echo "run releasing for PR: $PR_NUMBER with Name: $PR_TITLE"
          poetry run python ./demisto_sdk/scripts/changelog/changelog.py --release -n "$PR_NUMBER" -t "$PR_TITLE" -bn "$BRANCH_NAME"
