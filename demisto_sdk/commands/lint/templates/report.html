<!DOCTYPE html>
<html>
<head>
    <link href="https://unpkg.com/tabulator-tables@4.3.0/dist/css/tabulator_site.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.3.0/dist/js/tabulator.min.js"></script>
    <a data-toggle="collapse" href="#collapseNEWS" aria-expanded="true" aria-controls="collapseNEWS"><i
            class="fa fa-chevron-circle-up" aria-hidden="true"></i></a>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
<div id="report-table"></div>
<script>
    function myFunction(id) {
        var divs = document.getElementsByClassName(id);
        for (var i = 0; i < divs.length; i++) {
            if (divs[i].style.display === "none") {
                divs[i].style.display = "block";
            } else {
                divs[i].style.display = "none";
            }
        }

    }

    //define some sample data
    var tabledata = [
        {
            "id": 1,
            "pkg": "Integrations",
            "path": "Integrations/Akamai_WAF",
            "images": [
                {
                    "image": "demisto/akamai:1.0.0.5063",
                    "python_version": "3.7\n",
                    "image_errors": null,
                    "pylint_errors": null,
                    "pytest_xml": "<?xml version=\"1.0\" encoding=\"utf-8\"?><testsuite errors=\"0\" failures=\"1\" name=\"pytest\" skipped=\"0\" tests=\"2\" time=\"0.066\"><testcase classname=\"test_new\" file=\"test_new.py\" line=\"0\" name=\"test_3\" time=\"0.002\"><failure message=\"AssertionError: assert {&apos;bye&apos;: 5, &apos;hello&apos;: 1} == {&apos;bye&apos;: 8, &apos;hello&apos;: 7}\n  Differing items:\n  {&apos;hello&apos;: 1} != {&apos;hello&apos;: 7}\n  {&apos;bye&apos;: 5} != {&apos;bye&apos;: 8}\n  Full diff:\n  - {&apos;bye&apos;: 5, &apos;hello&apos;: 1}\n  ?         ^           ^\n  + {&apos;bye&apos;: 8, &apos;hello&apos;: 7}\n  ?         ^           ^\">def test_3():\n&gt;       assert {&quot;hello&quot;: 1, &quot;bye&quot;: 5} == {&quot;hello&quot;: 7, &quot;bye&quot;: 8}\nE       AssertionError: assert {&apos;bye&apos;: 5, &apos;hello&apos;: 1} == {&apos;bye&apos;: 8, &apos;hello&apos;: 7}\nE         Differing items:\nE         {&apos;hello&apos;: 1} != {&apos;hello&apos;: 7}\nE         {&apos;bye&apos;: 5} != {&apos;bye&apos;: 8}\nE         Full diff:\nE         - {&apos;bye&apos;: 5, &apos;hello&apos;: 1}\nE         ?         ^           ^\nE         + {&apos;bye&apos;: 8, &apos;hello&apos;: 7}\nE         ?         ^           ^\n\ntest_new.py:2: AssertionError</failure></testcase><testcase classname=\"test_new\" file=\"test_new.py\" line=\"4\" name=\"test_4\" time=\"0.002\"></testcase></testsuite>"
                }
            ],
            "flake8_errors": "/Users/grabin/dev/demisto/content/Integrations/Akamai_WAF/test_new.py:6:18: W292 no newline at end of file\n",
            "bandit_errors": null,
            "mypy_errors": null,
            "exit_code": 0
        }
    ];

    tabledata.forEach(function (a) {
        if (a.exit_code === 0) {
            a.exit_code = true;
        } else {
            a.exit_code = false;
        }
    })

    var hideIcon = function (cell, formatterParams, onRendered) { //plain text value
        return "<i class='fa'></i>";
    };


    //create Tabulator on DOM element with id "example-table"
    var table = new Tabulator(
        "#report-table", {
            data: tabledata,
            height: "100%",
            layout: "fitColumns",
            pagination: "local",
            paginationSize: 10,
            movableColumns: true,
            responsiveLayout: "collapse",
            responsiveLayoutCollapseStartOpen: false,
            columns: [
                {
                    title: "Package",
                    field: "pkg",
                    frozen: true,
                    headerFilter: "input",
                    sorter: "string",
                    width: "20%"
                },
                {
                    title: "Status",
                    field: "exit_code",
                    align: "center",
                    formatter: "tickCross",
                    width: "20%"
                },
                {
                    title: "Path",
                    field: "path",
                    width: "40%"
                },
                {
                    title: "Lints",
                    formatter: "responsiveCollapse",
                    headerSort: false,
                    width: "10%",
                    field: "path",
                    cellClick: function (e, cell) {
                        myFunction(cell.getData().path);
                    },
                },
                {
                    title: "Images",
                    editor:true,
                    formatter:"tickCross",
                    field: "images",
                    width: "9%",
                    cellClick: function (e, cell) {
                        myFunction(cell.getData().path);
                    },
                },
                {
                    title: "Flake8",
                    field: "flake8_errors",
                    formatter: "responsiveCollapse",
                    headerSort: false
                },
                {
                    title: "Bandit",
                    field: "bandit_errors",
                    formatter: "responsiveCollapse",
                    headerSort: false
                },
                {
                    title: "Mypy",
                    field: "mypy_errors",
                    formatter: "responsiveCollapse",
                    headerSort: false
                }
            ],
            rowFormatter: function (row, e) {
                //create and style holder elements
                var holderEl = document.createElement("div");
                var tableEl = document.createElement("div");

                const path = row.getData().path;

                holderEl.style.boxSizing = "border-box";
                holderEl.style.padding = "10px 10px 10px 10px";
                holderEl.style.borderTop = "1px solid #333";
                holderEl.style.borderBotom = "1px solid #333";
                holderEl.style.background = "#ddd";
                holderEl.setAttribute("class", path);


                tableEl.style.border = "1px solid #333";
                tableEl.setAttribute("class", path);

                holderEl.appendChild(tableEl);
                row.getElement().appendChild(holderEl);
                var subTable = new Tabulator(tableEl, {
                    data: row.getData().images,
                    columns: [
                        {
                            title: "Image",
                            field: "image"
                        },
                        {
                            title: "Pytest",
                            field: "pytest_xml"
                        },
                        {
                            title: "Pylint",
                            field: "pylint_errors"
                        },
                    ]
                });
                tableEl.style.display = "none"
                holderEl.style.display = "none"

            }
        });
</script>
</body>
</html>
